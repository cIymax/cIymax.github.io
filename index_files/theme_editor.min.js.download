(()=>{var z=window.I,C=window.React,V=window.ReactDOM,T=window.ReactDOMFactories,q=window.ReactTransitionGroup,k=window.PropTypes,O=window.classNames,w=window.R;C||z.libs.react.done(function(){return C=window.React,V=window.ReactDOM,T=window.ReactDOMFactories,q=window.ReactTransitionGroup,k=window.PropTypes,O=window.classNames,w=window.R});var K=null;z.libs.react.done(function(){var o,n;return o=T,n=o.img,K=function(a){var l,b,r,s,u;return a==null&&(a={}),u=(b=a.width)!=null?b:24,l=(r=a.height)!=null?r:u,C.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:(s=a.stroke_width)!=null?s:"2",width:u,height:l,strokeLinejoin:"round","aria-hidden":!0,fill:"none"},C.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),C.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},K=C.createElement.bind(null,C.memo(K))});var J=null,ve=null,B=null;I.libs.react.done(function(){var o,n,a,l,b,r,s,u;return o=T,n=o.a,b=o.div,a=o.button,s=o.label,r=o.h2,u=o.p,l=null,B=function(m){return m.promise?(I.Lightbox.open_loading(),m.then(function(d){return function(p){return I.Lightbox.open(p)}}(this))):I.Lightbox.open(m)},J=w.component("Lightbox",{is_modal_dialog:function(){var m;return m=document.getElementById("lightbox_container"),m!=null?m.contains(this.container_ref.current):void 0},getInitialState:function(){return{}},componentDidMount:function(){if(this.is_modal_dialog())return l?console.warn("A dialog already has the focus trap"):(this.detect_focus=function(m){return function(d){var p;if(p=m.container_ref.current,p&&"contains"in p&&!(p===d.target||p.contains(d.target)))return p.focus()}}(this),$(document.body).on("focusin",this.detect_focus),l=this),this.setState({previously_focused:document.activeElement,is_modal_dialog:!0},function(){return _.defer(function(m){return function(){var d;return(d=m.container_ref.current)!=null?d.focus():void 0}}(this))})},componentWillUnmount:function(){var m;return this.detect_focus&&($(document.body).off("focusin",this.detect_focus),l=null,delete this.detect_focus),(m=this.state.previously_focused)!=null?m.focus():void 0},close:function(){return I.Lightbox.close()},render:function(){return b({className:classNames("lightbox",this.props.className),style:this.props.style,role:this.state.is_modal_dialog?"dialog":void 0,"aria-modal":this.state.is_modal_dialog?"true":void 0,tabIndex:this.state.is_modal_dialog?-1:void 0,ref:this.container_ref||(this.container_ref=React.createRef())},this.props.close!==!1?a({className:"close_button",type:"button","aria-label":"Close Dialog"},K({width:18})):void 0,this.props.children)}}),ve=w.component("ErrorLightbox",{propTypes:{title:k.string,errors:k.array.isRequired},render:function(){return J({className:classNames(this.enclosing_class_name(),"compact")},r({},this.props.title||this.tt("misc.lightboxes.error_title")),w.Forms.FormErrors({title:!1,errors:this.props.errors}),u({className:"buttons"},a({className:"button",type:"button",onClick:function(m){return function(){return I.Lightbox.close()}}(this)},"Close")))}})});var te=null;I.libs.react.done(function(){var o,n,a,l,b,r,s;return n=T,b=n.h2,r=n.p,s=n.strong,a=n.a,l=n.button,o=w.package("ThemeEditor"),te=o("CSSInstructionsLightbox",{render:function(){return w.Lightbox({ref:this.lightbox_ref||(this.lightbox_ref=C.createRef()),className:"css_instructions_lightbox_widget"},b({},"Custom CSS"),r({},"Keep in mind we sometimes upgrade itch.io's pages and it's difficult to ensure those changes don't conflict with custom layouts people have done with the CSS editor. ",s({},"Enhancing existing components instead of trying to redo the entire page is the best way to avoid any problems. ")),r({},"Please read the ",a({href:this.props.css_guide_url,target:"_blank"},"Custom CSS guide")," before using any custom CSS."),r({},"If there's a customization you think that we should include as part of the theme editor then ",a({href:"/support",target:"_blank"},"send us a message"),"."),r({},l({type:"button",className:"button",onClick:function(u){return function(){var m;return(m=u.lightbox_ref.current)!=null?m.close():void 0}}(this)},"Got it")))}})});var he=null;I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m;return n=T,r=n.h2,u=n.p,b=n.fragment,a=n.a,l=n.div,s=n.input,m=n.textarea,b=C.createElement.bind(null,C.Fragment),b.type=C.fragment,o=w.package("ThemeEditor"),he=o("CssEditorLightbox",{pure:!0,render:function(){return J({ref:this.lightbox_ref||(this.lightbox_ref=C.createRef()),className:classNames(this.enclosing_class_name(),"compact")},r({},"Edit CSS"),u({},"Changes are automatically applied.",this.props.css_guide_url?b({}," ",a({href:this.props.css_guide_url,target:"_blank",onClick:function(d){return function(p){return p.preventDefault(),B(te({css_guide_url:d.props.css_guide_url}))}}(this)},"Info about CSS on itch.io.")):void 0),l({className:"input_wrapper"},m({defaultValue:this.props.default_value,onChange:this.props.on_change,placeholder:"Type CSS here"})))}})});var ye=[].slice,ne=null;I.libs.react.done(function(){var o,n,a,l,b;return n=T,l=n.h2,b=n.p,a=n.button,o=w.package("ThemeEditor"),ne=o("ErrorLightbox",{propTypes:{title:k.string,errors:k.array.isRequired},render:function(){return J.apply(null,[{ref:this.lighbox_ref||(this.lighbox_ref=C.createRef()),className:"game_edit_error_lightbox_widget compact"},l({},this.props.title||"We encountered an error")].concat(ye.call(this.props.errors.map(function(r){return function(s){return b({},s)}}(this))),[b({className:"sub_text"},this.props.sub_text)],[b({className:"buttons"},a({className:"button",type:"button",onClick:function(r){return function(){var s;return(s=r.lighbox_ref.current)!=null?s.close():void 0}}(this)},"Close"))]))}})});var xe={}.hasOwnProperty,ke=[].slice;I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m,d,p,f,h,g,i,t;return n=T,d=n.li,b=n.button,f=n.select,h=n.span,l=n.br,a=n.a,u=n.h2,r=n.div,s=n.form,m=n.input,p=n.p,t=n.ul,o=R.package("ThemeEditor"),i=PropTypes,g=function(e){return function(c){return c.stopPropagation()}}(this),o("FontPickerFontRow",{pure:!0,render:function(){var e;return e=this.props.font,d({},b({onClick:this.props.select_font,type:"button","data-family":e.family},h({},h({className:"family_name"},e.family),l({}),h({className:"category"},e.category)),a({href:"https://fonts.google.com/specimen/"+e.family,target:"_blank",onClick:g},"preview")))}}),o("FontPickerLightbox",{getInitialState:function(e){return function(){return{loading_fonts:!0,filter_category:"all"}}}(this),render:function(){var e;return R.Lightbox({className:"font_picker_lightbox_widget compact"},u({},"Select a font"),r({className:"form"},r({className:"font_filter"},m({type:"text",value:this.state.filter||"",onChange:function(c){return function(v){var y;return y=v.currentTarget.value,$.trim(y)===""&&(y=null),c.reset_scroll(),c.setState({filter:y})}}(this),placeholder:"Search for font by name..."}),R.Forms.SimpleSelect({value:this.state.filter_category,onChange:function(c){return function(v){return c.reset_scroll(),c.setState({filter_category:v})}}(this),options:[{name:"All fonts",value:"all"}].concat(ke.call(function(){var c,v;c=this.state.font_categories||[],v=[];for(e in c)xe.call(c,e)&&v.push({name:e,value:e});return v}.call(this)))})),this.render_font_list(),p({className:"google_fonts"},"These fonts are pulled from Google Fonts, consider ",a({href:"https://fonts.google.com/",target:"_blank"},"using their directory")," and typing the font name here.")))},reset_scroll:function(){if(this.refs.scroller)return this.refs.scroller.scrollTop=0},select_font:function(e){var c,v;if(v=e.currentTarget,!$(v).is("[href]"))return typeof(c=this.props).on_pick_font=="function"?c.on_pick_font(v.dataset.family):void 0},render_font_list:function(){var e,c,v;return this.state.loading_fonts?p({className:"loading"},"Loading list..."):(v=this.state.filter?new RegExp("\\b"+I.escape_regex($.trim(this.state.filter)),"i"):void 0,c=function(y){return function(x){return y.state.filter_category!=="all"&&x.category!==y.state.filter_category?!1:y.state.filter?x.family===y.state.filter?!0:v.test(x.family):!0}}(this),e=this.state.fonts.filter(c).map(function(y){return function(x){return o.FontPickerFontRow({key:x.family,select_font:y.select_font,font:x})}}(this)),t({className:"font_list",ref:"scroller"},e.length?e:d({className:"empty_search"},"No results found")))},componentDidMount:function(){var e;return e=this.props.fonts?$.when(this.props.fonts):$.getJSON(this.props.fonts_url),e.then(function(c){return function(v){var y,x,S,E;for(x={},S=0,E=v.length;S<E;S++)y=v[S],x[y.category]||(x[y.category]=0),x[y.category]+=1;return c.setState({loading_fonts:!1,font_categories:x,fonts:v})}}(this))}})});var Q,A,re,se,oe,ie,H,_e,ae,Z,le,ue,ee,de,fe,ce,we=[].slice;Z=function(o,n,a){return o<0?o+=1:o>1&&(o-=1),6*o<1?n+(a-n)*6*o:2*o<1?a:3*o<2?n+(a-n)*(2/3-o)*6:n},re=function(o,n,a){var l,b,r,s,u;return o=o/360,n=n/100,a=a/100,n===0?(r=a,b=a,l=a):(u=a<.5?a*(1+n):a+n-a*n,s=2*a-u,r=Z(o+1/3,s,u),b=Z(o,s,u),l=Z(o-1/3,s,u)),[r*255,b*255,l*255]},le=function(o,n,a){var l,b,r,s,u;return o=o/255,n=n/255,a=a/255,s=Math.min(o,n,a),r=Math.max(o,n,a),u=0,l=0,b=(s+r)/2,s!==r&&(u=b<.5?(r-s)/(r+s):(r-s)/(2-r-s),l=function(){switch(r){case o:return(n-a)/(r-s);case n:return 2+(a-o)/(r-s);case a:return 4+(o-n)/(r-s)}}()),l<0&&(l+=6),[l*60,u*100,b*100]},ie=function(){var o,n,a,l,b,r,s,u,m,d,p;if(d=arguments[0],u=2<=arguments.length?we.call(arguments,1):[],l="[a-fA-f0-9]",b=l+l,p="^#("+l+")("+l+")("+l+")$",m="^#("+b+")("+b+")("+b+")$",r=d.match(new RegExp(p)),r)o=r[0],s=r[1],a=r[2],n=r[3],s+=s,a+=a,n+=n;else{if(r=d.match(new RegExp(m)),!r)return null;o=r[0],s=r[1],a=r[2],n=r[3]}return[parseInt(s,16),parseInt(a,16),parseInt(n,16)]},H=function(){var o;return o=ie.apply(null,arguments),o||[0,0,0]},Q=function(o){var n;return n=Math.floor(o).toString(16),n.length===1?"0"+n:n},A=function(o,n,a){return o=Math.min(255,Math.max(0,o)),n=Math.min(255,Math.max(0,n)),a=Math.min(255,Math.max(0,a)),"#"+Q(o)+Q(n)+Q(a)},de=function(o,n,a){var l,b,r,s,u;return n==null&&(n=15),a==null&&(a=.8),s=le.apply(null,H(o)),l=s[0],u=s[1],b=s[2],r=b>50?b-n:b+n,r=Math.max(0,Math.min(100,r)),A.apply(null,re(l,u*a,r))},se=function(o,n,a){return(.299*o+.587*n+.114*a)/255},ae=function(o,n,a){return o=o/255,n=n/255,a=a/255,o=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),a=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),.2126*o+.7152*n+.0722*a},ue=function(o,n,a){var l,b,r;return r=.299*o+.587*n+.114*a,l=(a-r)*.565,b=(o-r)*.713,[r,l,b]},ce=function(o,n,a){var l,b,r;return r=o+1.403*a,b=o-.344*n-.714*a,l=o+1.77*n,[r,b,l]},ee=function(o,n,a,l){var b,r,s,u;return l==null&&(l=.1),b=ue(o,n,a),u=b[0],r=b[1],s=b[2],l<0?u+=l*u:u+=l*(255-u),ce(u,r,s)},_e=function(o,n,a){var l,b;return typeof o=="string"&&(l=H(o),o=l[0],n=l[1],a=l[2]),b=ae(o,n,a),b>=.45?oe(A(o,n,a),"#000000",.2):"#ffffff"},fe=function(o,n,a){var l,b,r,s,u;return n==null&&(n=.15),a==null&&(a=.5),u=H(o),s=u[0],b=u[1],l=u[2],r=se(s,b,l),r<a?A.apply(null,ee(s,b,l,n)):A.apply(null,ee(s,b,l,-n))},oe=function(o,n,a){var l,b,r,s,u,m,d,p,f;return a===1?o:a===0?n:(p=H(o),m=p[0],s=p[1],b=p[2],f=H(n),d=f[0],u=f[1],r=f[2],l=1-a,A(m*a+d*l,s*a+u*l,b*a+r*l))};var N=z.Color||(z.Color={hsl_to_rgb:re,rgb_to_hsl:le,parse_color:ie,parse_color_safe:H,hex_color:A,sub_color:de,luma:se,relative_luma:ae,rgb_to_yuv:ue,yuv_to_rgb:ce,scale_luma:ee,readable_text_color:_e,sub_color2:fe,mix_color:oe}),Ne=[].slice,pe=z.theme_template_scope||(z.theme_template_scope={first:function(o,n,a,l){var b,r;return(b=(r=o!=null?o:n)!=null?r:a)!=null?b:Ne.call(arguments).find(function(s){return function(u){return u!=null}}(this))},when:function(o,n,a,l){return o===n?a:l},sub_color2:N.sub_color2,sub_color:N.sub_color,mix_color:N.mix_color,alpha:function(o,n){var a,l,b,r;return r=N.parse_color_safe(o),b=r[0],l=r[1],a=r[2],"rgba("+b+", "+l+", "+a+", "+n+")"},bg_color_for_input:function(o){var n,a,l;return n=N.sub_color2(o,.1),a=N.luma.apply(N,N.parse_color_safe(o)),l=Math.min(1,Math.max(0,(a-.5)*2)),N.mix_color("#ffffff",n,l)},text_color_for_bg:function(o){return N.readable_text_color(o)},text_shadow_color_for_bg:function(o){var n;return n=N.relative_luma.apply(N,N.parse_color_safe(o)),n>=.45?"transparent":N.sub_color2(o)}}),me=null,U=null;z.libs.react.done(function(){var o,n,a,l,b;return n=T,l=n.div,a=n.button,b=n.input,o=w.package("Forms"),o("PortalElement",{getInitialState:function(){return this.el=document.createElement("div"),$(this.el).addClass("portal_element"),{}},componentDidMount:function(){return this.props.container_el.appendChild(this.el)},componentWillUnmount:function(){return this.props.container_el.removeChild(this.el)},render:function(){return V.createPortal(this.props.children,this.el)}}),me=o("ColorWheel",{render:function(){var r,s,u,m,d,p,f,h,g;return(m=this.state)!=null&&m.color&&!this.props.onChange?(d=this.state.color,r=d[0],f=d[1],s=d[2]):this.props.color&&(p=this.props.color,r=p[0],f=p[1],s=p[2]),r==null&&(r=0),f==null&&(f=50),s==null&&(s=100),u=(r-90)/180*Math.PI,h=Math.cos(u),g=Math.sin(u),this.enclose({},l({className:"color_block",style:{background:"hsl("+r+", 100%, 50%)",width:"101px",height:"101px"}}),l({className:"wheel",style:{width:"195px",height:"195px"},onMouseDown:function(i){return function(t){return t.preventDefault(),i.start_drag(t,t.target,function(e,c){var v,y;return h=(e-.5)*2,g=(c-.5)*2,v=Math.atan2(g,h)/Math.PI*180,y=(v+360+90)%360,i.update_color(y,f,s)})}}(this)}),l({className:"mask",style:{width:"101px",height:"101px"},onMouseDown:function(i){return function(t){return t.preventDefault(),i.start_drag(t,t.target,function(e,c){var v,y;return y=(1-e)*100,v=(1-c)*100,i.update_color(r,y,v)})}}(this)}),l({className:"marker h-marker",style:{left:97+h*84+"px",top:97+g*84+"px"}}),l({className:"marker sl-marker",style:{left:47+101*(100-f)/100+"px",top:47+101*(100-s)/100+"px"}}))},set_hex_color:function(r){var s,u,m,d;try{return d=N.parse_color(r),m=d[0],u=d[1],s=d[2],this.setState({color:N.rgb_to_hsl(m,u,s)})}catch(p){}},update_color:function(r,s,u){return this.props.onChange!=null?this.props.onChange([r,s,u]):this.setState({color:[r,s,u]})},start_drag:function(r,s,u){var m,d,p;if(!((d=this.state)!=null&&d.dragging))return this.setState({dragging:!0}),m=function(f){var h,g,i,t,e;if(f.preventDefault(),f.buttons===0){p();return}return i=s.getBoundingClientRect(),t=f.clientX,e=f.clientY,h=(t-i.left)/(i.right-i.left),g=(e-i.top)/(i.bottom-i.top),h=Math.min(1,Math.max(0,h)),g=Math.min(1,Math.max(0,g)),typeof u=="function"?u(h,g):void 0},p=function(f){return function(h){return h!=null&&h.preventDefault(),document.body.removeEventListener("mousemove",m),document.body.removeEventListener("mouseup",p),delete f.up_listener,f.setState({dragging:!1})}}(this),document.body.addEventListener("mousemove",m),document.body.addEventListener("mouseup",p),m(r),this.up_listener=p}}),o("ColorInputPopup",{palette:["#193d3f","#3f2832","#743f39","#9e2835","#b86f50","#327345","#e53b44","#4f6781","#0484d1","#fb922b","#afbfd2","#63c64d","#e4a672","#2ce8f4","#ffe762"],set_wheel_color:function(r){var s,u,m,d;try{return d=N.parse_color(r),m=d[0],u=d[1],s=d[2],this.setState({wheel_color:N.rgb_to_hsl(m,u,s)})}catch(p){}},componentDidMount:function(){var r;if(!((r=this.state)!=null&&r.wheel_color)&&this.props.color)return this.set_wheel_color(this.props.color)},render:function(){var r,s,u,m;return this.wheel_ref||(this.wheel_ref=C.createRef()),r=this.props.palette||this.palette,(s=this.props.position)&&(m={left:s.left+"px",top:s.top+"px"}),this.enclose({className:"color_popout",style:m},this.props.allow_empty&&this.props.color?a({type:"button",className:"clear_color_btn",onClick:function(d){return function(){var p;return typeof(p=d.props).set_color=="function"?p.set_color(""):void 0}}(this)},"Clear"):void 0,me({ref:this.wheel_ref,color:(u=this.state)!=null?u.wheel_color:void 0,onChange:function(d){return function(p){var f;return typeof(f=d.props).set_color=="function"&&f.set_color(N.hex_color.apply(N,N.hsl_to_rgb.apply(N,p))),d.setState({wheel_color:p})}}(this)}),r?l({className:"palette_options"},r.map(function(d){return function(p){return a({key:p,type:"button",style:{backgroundColor:p},onClick:function(f){var h;return typeof(h=d.props).set_color=="function"&&h.set_color(p),d.set_wheel_color(p)}},p)}}(this))):void 0)}}),U=o("ColorInput",{pure:!0,propTypes:{name:k.string,value:k.any,defaultValue:k.any,allow_empty:k.bool,popout_portal_target:k.object},componentDidMount:function(){return U.active_inputs||(U.active_inputs=[]),U.active_inputs.push(this)},componentWillUnmount:function(){var r;return U.active_inputs=function(){var s,u,m,d;for(m=U.active_inputs,d=[],s=0,u=m.length;s<u;s++)r=m[s],r!==this&&d.push(r);return d}.call(this)},componentDidUpdate:function(r,s){var u,m,d;if(m=r.value||"",d=this.props.value||"",m!==d&&(u=this.set_color(d)))return this.refs.input.value=u},getInitialState:function(){return{open:!1,last_value:this.props.value||this.props.defaultValue||""}},on_blur:function(){if(!this.set_color_from_input())return this.input_ref.current.value=this.state.last_value,this.set_color(this.state.last_value)},set_color_from_input:function(){var r,s,u;return s=this.input_ref.current.value,s===""&&this.props.allow_empty?(this.setState({has_error:!1,last_value:""}),!0):(s!==""&&!s.match("^#")&&(s="#"+s,this.input_ref.current.value=s),r=N.parse_color(s),r?(this.set_color(s),(u=this.popout_ref.current)!=null&&u.set_wheel_color(s),!0):(this.setState({has_error:!0}),!1))},set_color:function(r){var s;return this.input_ref.current.value=r,this.setState({last_value:r,has_error:!1}),typeof(s=this.props).onChange=="function"?s.onChange(r):void 0},open:function(){if(!this.state.open)return this.setState({open:!0,on_left:this.popout_on_left(),popout_position:this.popout_position()}),this.click_outside_handler||(this.click_outside_handler=function(r){return function(s){var u,m,d;if(d=V.findDOMNode(r),!$(s.target).closest(d).length&&!((m=r.popout_ref.current)&&(u=V.findDOMNode(m),$(s.target).closest(u).length)))return r.close()}}(this)),$(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler)return $(document.body).off("mousedown",this.click_outside_handler)},close:function(){if(this.state.open)return this.setState({open:!1}),$("document.body").off("mousedown",this.click_outside_handler)},popout_position:function(){var r,s;if(this.props.popout_portal_target)return r=V.findDOMNode(this),s=r.getBoundingClientRect(),{left:Math.trunc(s.right+window.scrollX),top:Math.trunc(s.top+window.scrollY)}},popout_on_left:function(){var r,s;return r=$(V.findDOMNode(this)),s=r.offset().left+r.width()+250,s>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var r,s;return this.popout_ref||(this.popout_ref=C.createRef()),s=o.ColorInputPopup({ref:this.popout_ref,palette:this.props.palette,color:this.state.last_value,allow_empty:this.props.allow_empty,set_color:this.set_color,position:this.state.popout_position}),(r=this.props.popout_portal_target)&&(s=o.PortalElement({container_el:r},s)),s},render:function(){var r;return r=this.state.last_value||"#ffffff",this.input_ref||(this.input_ref=C.createRef()),this.enclose({className:O(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left,color_error:this.state.has_error})},b({ref:this.input_ref,type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.on_blur,onFocus:this.open,onKeyDown:function(s){return function(u){switch(u.keyCode){case 9:return s.close()}}}(this),onKeyUp:function(s){return function(u){return s.set_color_from_input()}}(this)}),l({className:"color_swatch",onClick:this.open,style:{backgroundColor:r}}),this.state.open?this.render_color_popout():void 0)}})});var Y=null;z.libs.react.done(function(){var o,n,a,l,b,r;return n=T,b=n.input,r=n.p,l=n.div,a=n.button,o=w.package("Forms"),Y=o("Slider",{pure:!0,propTypes:{min:k.number,max:k.number,value:k.number,onChange:k.func,disabled:k.bool},getInitialState:function(){return{}},on_change:function(s){return s=Math.round(s),this.props.onChange?this.props.value===s?void 0:this.props.onChange(s):this.state.value===s?void 0:this.setState({value:s})},start_drag:function(s,u){var m,d,p,f;if(!this.props.disabled)return f=this.track_ref.current.clientWidth,d=this.current_value(),this.setState({dragging:!0}),m=function(h){return function(g){var i,t,e,c;if(g.preventDefault(),g.buttons===0){p();return}if(e=g.pageX,c=g.pageX,i=e-s,t=i/f*(h.props.max-h.props.min)+d,t=Math.min(h.props.max,Math.max(h.props.min,t)),t!==h.current_value())return h.on_change(t)}}(this),p=function(h){return function(g){return g!=null&&g.preventDefault(),h.setState({dragging:!1}),document.body.removeEventListener("mousemove",m),document.body.removeEventListener("mouseup",p),delete h.up_listener}}(this),document.body.addEventListener("mousemove",m),document.body.addEventListener("mouseup",p),this.up_listener=p},current_value:function(){return"value"in this.state?this.state.value||this.props.min:this.props.value||this.props.min},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener)return this.up_listener()},render:function(){var s;return s={left:this.percent()*100+"%"},this.enclose({className:O("slider_input",{disabled:this.props.disabled}),onClick:function(u){return function(m){var d,p;if(!u.props.disabled&&m.target!==u.slider_nub_ref.current&&(p=u.track_ref.current.getBoundingClientRect(),r=Math.min(p.width,Math.max(0,m.pageX-p.left))/p.width,d=u.props.min+r*(u.props.max-u.props.min),d=Math.min(u.props.max,Math.max(u.props.min,d)),d!==u.current_value()))return u.on_change(d)}}(this)},this.props.name?b({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,l({ref:this.track_ref||(this.track_ref=C.createRef()),className:"slider_track"},l({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?l({style:s,className:"value_tooltip"},this.current_value()):void 0,a({type:"button",ref:this.slider_nub_ref||(this.slider_nub_ref=C.createRef()),className:O("slider_nub",{disabled:this.props.disabled}),onFocus:function(u){return function(){return u.setState({focused:!0})}}(this),onBlur:function(u){return function(){return u.setState({focused:!1})}}(this),onMouseDown:function(u){return function(m){return u.start_drag(m.pageX,m.pageY)}}(this),onKeyDown:function(u){return function(m){switch(m.keyCode){case 37:u.on_change(Math.max(u.props.min,u.current_value()-1));break;case 39:u.on_change(Math.min(u.props.max,u.current_value()+1));break;default:return}return m.preventDefault()}}(this),style:s})))}})});var W=null;z.libs.react.done(function(){var o,n,a,l,b,r,s,u,m,d;return n=T,s=n.img,m=n.label,l=n.button,a=n.a,d=n.pre,u=n.input,r=n.div,o=w.package("Forms"),b=0,o("ImagePreview",{pure:!0,getInitialState:function(){return{loaded:!1}},render:function(){return s({className:O(this.enclosing_class_name(),this.props.className,{image_loading:!this.state.loaded}),src:this.props.src,onLoad:function(p){return function(){var f;return p.setState({loaded:!0}),typeof(f=p.props).on_load=="function"?f.on_load():void 0}}(this)})}}),o("VideoPreview",{pure:!0,render:function(){return C.createElement("video",{width:200,loop:!0,muted:!0,autoPlay:!0,src:this.props.src})}}),W=o("ImageUploader",{pure:!0,propTypes:{upload_url:k.string.isRequired,name:k.string.isRequired,thumb_size:k.string,label:k.string,upload:k.object,show_replace:k.bool},getDefaultProps:function(){return{remove_button_classes:["button","outline","small"],replace_button_classes:["button","outline","small"],upload_button_classes:"button"}},getInitialState:function(){return{active_uploads:[],uploads:this.props.upload?[this.props.upload]:this.props.uploads}},push_errors:function(p){var f,h,g,i;return typeof p=="string"&&(p=[p]),h=function(){var t,e,c;for(c=[],t=0,e=p.length;t<e;t++)if(f=p[t],typeof f=="string")c.push(f);else if(Array.isArray(f))i=f[0],g=f[1],g?c.push(g.name+" - "+i):c.push(i);else continue;return c}(),this.setState(function(t){return{errors:(t.errors||[]).concat(h)}})},get_progress:function(){return Math.min.apply(Math,this.state.active_uploads.map(function(p){return function(f){return f.progress}}(this)))},pick_image:function(p){return this.setState({errors:[]}),z.upload_image({url:this.props.upload_url,accept:this.props.accept,thumb_size:this.props.thumb_size,multiple:this.props.multiple,max_size:this.props.max_size,test_file:function(f){return function(h,g){return $.when(z.test_image_dimensions(h),z.test_image_format(h)).done(function(){return g.resolve()}).fail(function(i){return g.reject(i)})}}(this),on_start_upload:function(f){return function(h,g,i){var t;return t={file:h,upload:g,xhr:i,progress:0},f.setState(function(e){return{active_uploads:e.active_uploads.concat([t]),uploading:!0}}),i.progress(function(e,c,v){var y;return y=Object.assign({},t,{progress:c/v}),f.setState(function(x){return{active_uploads:x.active_uploads.map(function(S){return function(E){return E===t?y:E}}(this))}}),t=y}).done(function(e){var c;if(e.errors){f.push_errors(e.errors);return}if(g=e.upload,typeof p=="function"&&p(),g)return typeof(c=f.props).on_upload=="function"&&c.on_upload(g),f.setState(function(v){return{uploads:(v.uploads||[]).concat([g])}})}).always(function(){return f.setState(function(e){var c;return c=e.active_uploads.filter(function(v){return function(y){return y!==t}}(this)),{uploading:!!c.length,active_uploads:c}})})}}(this)}).fail(function(f){return function(h){return f.push_errors(h)}}(this))},remove_image:function(p){var f,h;if(h=this.state.uploads[p],this.setState(function(g){var i;return{uploads:function(){var t,e,c,v;for(c=this.state.uploads,v=[],t=0,e=c.length;t<e;t++)i=c[t],i!==h&&v.push(i);return v}.call(this)}}),!this.props.multiple)return typeof(f=this.props).on_upload=="function"?f.on_upload(null):void 0},render_existing_upload:function(p,f){var h;return h=this.props.multiple?this.props.name+"["+(f+1)+"]":this.props.name,r({className:"existing_upload",key:p.id},u({type:"hidden",name:h,value:p.id}),p.thumb_url?r({className:"preview_image"},p.thumb_url.match(/\.mp4$/)?o.VideoPreview({src:p.thumb_url}):o.ImagePreview({src:p.thumb_url})):void 0,this.props.children,r({className:"existing_upload_tools"},this.props.show_replace?l({className:O("replace_image_btn",this.props.replace_button_classes),type:"button",onClick:function(g){return function(i){return i.preventDefault(),g.pick_image(function(){return g.remove_image(f)})}}(this)},"Replace image"):void 0,l({className:O("remove_image_btn",this.props.remove_button_classes),type:"button",onClick:function(g){return function(i){return i.preventDefault(),g.remove_image(f)}}(this)},"Remove image")))},render:function(){var p,f,h,g,i,t;return this.autogen_id="image-uploader-"+b++,p=!!((f=this.state.uploads)!=null&&f.length),this.enclose({className:O(this.props.className,{no_upload:!p,have_upload:!!p})},this.props.label?m({className:"label",htmlFor:this.autogen_id},this.props.label):void 0,(h=this.state.errors)!=null&&h.length?w.Forms.FormErrors({errors:this.state.errors,title:"Upload failed"}):void 0,this.props.multiple||(g=this.state.uploads)!=null&&g.length?void 0:u({type:"hidden",name:this.props.name,value:""}),this.state.uploading?r({className:"upload_progress"},this.state.active_uploads.length?"Uploading "+((this.get_progress()||0)*100).toFixed(2)+"%":"Uploading..."):void 0,this.props.multiple||!((i=this.state.uploads)!=null&&i.length)?l({id:this.autogen_id,disabled:!!this.state.uploading,className:O(this.props.upload_button_classes,{small:this.props.compact,disabled:!!this.state.uploading}),type:"button",onClick:function(e){return function(c){return c.preventDefault(),e.pick_image()}}(this)},this.props.upload_label||(this.props.multiple?"Upload images":"Upload image")):void 0,(t=this.state.uploads)!=null&&t.length?r({className:"existing_uploads",children:this.state.uploads.map(this.render_existing_upload)}):void 0)}})});var X=[].slice;I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m,d,p,f,h,g,i;return l=T,p=l.input,b=l.a,r=l.button,d=l.img,u=l.form,i=l.span,h=l.section,s=l.div,m=l.h3,f=l.label,g=l.select,a=q.TransitionGroup,o=q.CSSTransition,n=w.package("GameEdit"),n("ThemeEditor",{getInitialState:function(){return $.extend({open:this.props.open||!1,fonts:this.props.fonts,css_template:this.props.css_template?window.eval(this.props.css_template):void 0},this.props.theme)},render_to_css:function(){var t,e,c,v,y,x,S,E,D,j,P,M,G;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}return G=this.state.background_image?(t=function(){switch(this.state.background_position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}.call(this),_.compact(["background-image: url('"+this.state.background_image.thumb_url+"')","background-repeat: "+(this.state.background_repeat||"repeat"),"background-position: "+t,this.state.background_attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):"",x=this.state.embed_background_image?(c=["url('"+this.state.embed_background_image.thumb_url+"')"],(v=this.state.embed_background_color1)&&(y=(D=this.state.embed_background_color2)!=null?D:v,e=((j=this.state.embed_background_alpha)!=null?j:50)/100,P=pe.alpha,c.unshift("linear-gradient(to bottom, "+P(v,e)+", "+P(y,e)+")")),_.compact(["background-image: "+c.join(",")+";"])):"",S=this.state.fonts.find(function(F){return function(L){return L.slug===F.state.font_family}}(this)),E=this.state.fonts.find(function(F){return function(L){return L.slug===F.state.header_font_family}}(this)),M=$.extend(Object.create(pe),{wrapper_background_css:G,embed_background_css:x,font_family:w.ThemeEditor.escape_font_family((S!=null?S.family:void 0)||"inherit"),header_font_family:w.ThemeEditor.escape_font_family((E!=null?E.family:void 0)||"inherit"),header_text_color:this.state.header_text_color||"inherit"},_.pick.apply(_,[this.state].concat(X.call(["bg_color","bg2_color","text_color","link_color","button_color","header_text_color","screenshots_loc","default_screenshots_loc","bg2_alpha"])))),M=new Proxy(M,{has:function(F){return function(){return!0}}(this)}),this.state.css_template(M)},render_banner:function(){var t,e;if(this._header||(this._header=$("#header")),this._header.removeClass().addClass("header"),t=this.state.banner_image,t)return e=this.state.banner_position||"align_center",d=this._header.find("img"),this._header.addClass("has_image").addClass(e),d.exists()?d.attr("src",t.thumb_url):$("<img src='"+t.thumb_url+"'/>").appendTo(this._header)},load_font:function(t){var e;if(this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts)),!this.loaded_fonts[t]&&(this.loaded_fonts[t]=!0,e=this.state.fonts.find(function(c){return c.slug===t}),!!e&&e.href&&!$("link[data-font='"+e.slug+"']").exists()))return $("<link rel='stylesheet' href='"+e.href+"' data-font='"+e.slug+"'></link>").appendTo("head")},apply_css:function(){var t;return this.style_el||(this.style_el=$("#game_theme").exists()||$("<style type='text/css' id='game_theme'></style>").appendTo($("head"))),this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||""),this.props.can_use_css&&(this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head"))),this.custom_style_el[0].innerHTML=I.strip_css(this.state.css||"")),this.render_banner(),this.load_font(this.state.font_family),this.load_font(this.state.header_font_family),t=classNames(["inner_column",this.state.font_family?"family_"+this.state.font_family:void 0,this.state.font_size?"size_"+this.state.font_size:void 0]),$("#inner_column").removeClass().addClass(t)},componentDidUpdate:function(t,e){return this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100)),this.apply_css_throttled()},save:function(){return this.setState({loading:!0}),I.remote_submit($(this.refs.form)).then(function(t){return function(e){if(t.setState({loading:!1}),e.errors)return B(w.ThemeEditor.ErrorLightbox({errors:e.errors,sub_text:"Your changes were not saved, please try again"}))}}(this))},render:function(){return React.createElement(a,{key:"transition_group",component:"span"},this.state.open?React.createElement(o,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({className:"theme_editor_widget",key:"real"},u({ref:"form",method:"POST",action:this.props.submit_url,onSubmit:function(t){return function(e){return e.preventDefault(),t.save()}}(this)},w.CSRF({}),h.apply(null,[{className:"input_group"}].concat(X.call(this.render_color_pickers()))),h.apply(null,[{className:"input_group"}].concat(X.call(this.render_font_pickers()))),h.apply(null,[{className:"input_group"}].concat(X.call(this.render_layout_options()))),this.render_image_uploaders(),this.render_css_editor(),s({className:"buttons save_buttons"},r({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||!1},this.state.loading&&"Saving..."||"Save"))))},append_font:function(t){return this.setState({fonts:X.call(this.state.fonts).concat([t])})},render_font_pickers:function(){var t;return[m({},"Text"),f({className:"horiz_input"},i({className:"label_text"},"Font"),w.ThemeEditor.FontSelect({name:"layout[font_family]",value:this.state.font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_font_family||(this.set_font_family=function(e){return function(c){return e.setState({font_family:c})}}(this))})),f({className:"horiz_input"},i({className:"label_text"},"Size"),w.Forms.SimpleSelect({name:"layout[font_size]",value:this.state.font_size,onChange:this.set_font_size||(this.set_font_size=function(e){return function(c){return e.setState({font_size:c})}}(this)),options:this.font_size_options||(this.font_size_options=[{name:"Small",value:"small"},{name:"Medium",value:"medium"},{name:"Large",value:"large"},{name:"Very Large",value:"very_large"}])})),w.ThemeEditor.MoreGroup({label:"More options...",ref:"more_font_options",default_open:!!((t=this.props.theme)!=null&&t.header_font_family)},f({className:"horiz_input"},i({className:"label_text"},"Header font"),w.ThemeEditor.FontSelect({name:"layout[header_font_family]",allow_default:!0,value:this.state.header_font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_header_font_family||(this.set_header_font_family=function(e){return function(c){return e.setState({header_font_family:c})}}(this))})))]},render_align_select:function(t,e){var c;return f({className:"horiz_input"},i({className:"label_text"},"Align"),w.Forms.SimpleSelect({name:t,value:this.state[e],onChange:this[c="set_"+e]||(this[c]=function(v){return function(y){var x;return x={},x[e]=y,v.setState(x)}}(this)),options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])}))},render_image_uploaders:function(){var t;return h({className:"input_group"},m({},"Images"),W({compact:!0,upload_url:this.props.image_upload_url,upload:this.state.banner_image,name:"layout[banner_image][image_id]",label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(e){return function(c){return e.setState({banner_image:c})}}(this))},this.state.banner_image?s({className:"position_fields"},this.render_align_select("layout[banner_image][position]","banner_position")):void 0),W({compact:!0,upload_url:this.props.image_upload_url,upload:this.state.background_image,name:"layout[background_image][image_id]",label:"Background",upload_label:"Upload",on_upload:this.set_background_image||(this.set_background_image=function(e){return function(c){return e.setState({background_image:c})}}(this))},this.state.background_image?s({className:"position_fields"},f({className:"horiz_input"},i({className:"label_text"},"Repeat"),w.Forms.SimpleSelect({name:"layout[background_image][repeat]",value:this.state.background_repeat,onChange:this.set_background_repeat||(this.set_background_repeat=function(e){return function(c){return e.setState({background_repeat:c})}}(this)),options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),this.render_align_select("layout[background_image][position]","background_position"),f({className:"horiz_input"},i({className:"label_text"},"Fixed"),s({},p({type:"checkbox",name:"layout[background_image][attach]",value:"fixed",checked:this.state.background_attach==="fixed",onChange:this.set_background_attach||(this.set_background_attach=function(e){return function(c){return e.setState({background_attach:c.target.checked?"fixed":null})}}(this))})))):void 0),this.props.game_type==="html"||this.state.embed_background_image?W({compact:!0,upload_url:this.props.image_upload_url,name:"layout[embed_background_image][image_id]",label:"Embed BG",upload_label:"Upload",upload:this.state.embed_background_image,on_upload:function(e){return function(c){return e.setState({embed_background_image:c})}}(this)},s({className:"color_options"},f({className:"horiz_input"},i({className:"label_text"},"Color 1"),this.color_input("embed_background_color1",{name:"layout[embed_background_image][color1]"})),f({className:"horiz_input"},i({className:"label_text"},"Color 2"),this.color_input("embed_background_color2",{name:"layout[embed_background_image][color2]",allow_empty:!0})),f({className:"horiz_input"},i({className:"label_text"},"Alpha"),Y({min:0,max:100,show_tooltip:!0,value:(t=this.state.embed_background_alpha)!=null?t:50,name:"layout[embed_background_image][alpha]",onChange:this.set_embed_background_alpha||(this.set_embed_background_alpha=function(e){return function(c){return e.setState({embed_background_alpha:c})}}(this))})))):void 0)},color_input:function(t,e){var c,v;return e==null&&(e={}),U({name:(v=e.name)!=null?v:"layout["+t+"]",popout_portal_target:document.body,className:"compact",value:this.state[t],allow_empty:e.allow_empty,onChange:this[c="set_"+t]||(this[c]=function(y){return function(x){var S;return x===""&&(x=void 0),S={},S[t]=x,y.setState(S)}}(this))})},render_color_pickers:function(){var t,e,c,v;return[m({},"Color"),f({className:"horiz_input"},i({className:"label_text"},"BG"),this.color_input("bg_color")),f({className:"horiz_input"},i({className:"label_text"},"BG 2"),this.color_input("bg2_color")),f({className:"horiz_input"},i({className:"label_text"},"Text"),this.color_input("text_color")),f({className:"horiz_input"},i({className:"label_text"},"Link"),this.color_input("link_color")),w.ThemeEditor.MoreGroup({label:"More options...",ref:"more_color_options",default_open:((t=this.props.theme)!=null?t.header_text_color:void 0)||((e=this.props.theme)!=null?e.button_color:void 0)||((c=this.props.theme)!=null?c.bg2_alpha:void 0)!=null},f({className:"horiz_input"},i({className:"label_text"},"Headers"),this.color_input("header_text_color",{allow_empty:!0})),f({className:"horiz_input"},i({className:"label_text"},"Buttons"),this.color_input("button_color",{allow_empty:!0})),f({className:"horiz_input"},i({className:"label_text"},"BG2 Alpha"),Y({min:0,max:100,show_tooltip:!0,value:(v=this.state.bg2_alpha)!=null?v:100,name:"layout[bg2_alpha]",onChange:this.set_bg2_alpha||(this.set_bg2_alpha=function(y){return function(x){return y.setState({bg2_alpha:x})}}(this))})))]},render_css_editor:function(){if(this.props.can_use_css)return h({className:"input_group css_editor"},m({},"Misc"),w.ThemeEditor.CssEditor({name:"layout[css]",value:this.state.css,css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(t){return function(e){return t.setState({css:e.target.value})}}(this))}))},render_layout_options:function(){return[m({},"Layout"),f({className:"horiz_input"},i({className:"label_text"},"Screenshots"),w.Forms.SimpleSelect({name:"layout[screenshots_loc]",value:this.state.screenshots_loc||"",onChange:this.setup_screenshots_loc||(this.setup_screenshots_loc=function(t){return function(e){return e||(e=void 0),t.setState({screenshots_loc:e})}}(this)),options:this.screenshots_loc_options||(this.screenshots_loc_options=[{name:"Auto ("+this.state.default_screenshots_loc+")",short_name:"Auto",value:""},{name:"Sidebar",value:"sidebar"},{name:"Hidden",value:"hidden"}])}))]}})}),I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m;return a=T,s=a.img,u=a.input,r=a.div,m=a.span,b=a.button,l=a.a,n=w.package("ThemeEditor"),o=function(d){var p,f,h,g;return d==null&&(d={}),g=(f=d.width)!=null?f:18,p=(h=d.height)!=null?h:16,React.createElement("svg",{className:"svgicon icon_grab",fill:"currentColor",stroke:"none",role:"img",version:"1.1",viewBox:"0 0 18 16",width:g,height:p,"aria-hidden":!0},React.createElement("rect",{width:"18",height:"4"}),React.createElement("rect",{y:"12",width:"18",height:"4"}),React.createElement("rect",{y:"6",width:"18",height:"4"}))},o=React.createElement.bind(null,React.memo(o)),n("OrderPickerItem",{pure:!0,propTypes:{item:k.shape({id:k.number,order:k.number,name:k.string,hidden:k.bool,type:k.string},{position:k.number,input_name:k.string})},input_name:function(d){return this.props.input_name+"["+(this.props.position+1)+"]["+d+"]"},render:function(){var d;return d=this.props.item,r({"data-id":d.id,className:classNames("order_row",{dragging:this.props.dragging})},this.props.input_name?u({type:"hidden",className:"position_input",name:this.input_name("id"),value:d.id}):void 0,this.props.item.hidden&&this.props.input_name?u({type:"hidden",name:this.input_name("hidden"),value:"1"}):void 0,o({}),m({className:"item_name",title:d.name},d.name),b({type:"button",className:classNames("hide_btn",{is_active:this.props.item.hidden}),onClick:function(p){return function(f){return f.preventDefault(),p.trigger("order_picker_item:hidden",p.props.item,!p.props.item.hidden)}}(this)},this.props.item.hidden?"Hidden":"Hide"))}}),n("OrderPicker",{pure:!0,propTypes:{input_name:k.string,update_order:k.func,items:k.arrayOf(k.shape({id:k.number,name:k.string,hidden:k.bool,type:k.string}))},getInitialState:function(){return{items:this.props.items}},update_order:function(d){var p,f,h,g,i,t,e;for(g={},e=this.state.items,i=0,t=e.length;i<t;i++)f=e[i],g[""+f.id]=f;return h=d.map(function(c){return function(v){return g[v]}}(this)),this.setState({items:h}),typeof(p=this.props).update_order=="function"?p.update_order(h):void 0},componentDidMount:function(){var d;return d=$(this.list_ref.current),this.dispatch("order_picker_item",{hidden:function(p){return function(f,h,g){var i,t;return t=p.state.items.map(function(e){return h.id===e.id?$.extend({},h,{hidden:g}):e}),p.setState({items:t}),typeof(i=p.props).update_order=="function"?i.update_order(t):void 0}}(this)}),window.requestAnimationFrame(function(p){return function(){return d.sortable({cancel:"button"}).on("sortstop",function(f){var h;return h=d.sortable("toArray",{attribute:"data-id"}),d.sortable("cancel"),p.update_order(h)})}}(this))},render:function(){return this.enclose({ref:this.list_ref||(this.list_ref=React.createRef()),className:"sorting_picker"},this.state.items.map(function(d){return function(p,f){return w.ThemeEditor.OrderPickerItem({key:p.id,position:f,item:p,input_name:d.props.input_name})}}(this)))}})});var ge=[].slice,be=[].indexOf||function(o){for(var n=0,a=this.length;n<a;n++)if(n in this&&this[n]===o)return n;return-1};I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m,d,p,f,h,g;return l=T,d=l.input,b=l.a,g=l.span,f=l.p,u=l.form,s=l.div,r=l.button,h=l.section,m=l.h3,p=l.label,n=w.package("Profile"),a=q.TransitionGroup,o=q.CSSTransition,n("ThemeEditor",{getInitialState:function(){return{open:!1,fonts:this.props.fonts,css_template:this.props.css_template?window.eval(this.props.css_template):void 0,theme:this.props.theme,banner_image:this.props.banner_image,background_image:this.props.background_image}},update_theme:function(i,t){var e;if(this.state.theme[i]!==t)return e={},e[i]=t,this.setState({theme:Object.assign({},this.state.theme,e)})},componentDidUpdate:function(i,t){if(this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100)),this.apply_css_throttled(),(t.theme.game_order!==this.state.theme.game_order||t.theme.hidden_games!==this.state.theme.hidden_games)&&this.apply_project_order(),t.theme.collection_order!==this.state.theme.collection_order||t.theme.hidden_collections!==this.state.theme.hidden_collections)return this.apply_collection_order()},render_to_css:function(){var i,t,e,c,v;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}return t=this.state.fonts.find(function(y){return function(x){return x.slug===y.state.theme.font_family}}(this)),i=w.ThemeEditor.background_css(this.state.background_image,this.state.theme.background_image),v=Object.assign(Object.create(pe),{font_size:((e=this.state.theme.font_size)!=null?e:100)+"%",font_family:w.ThemeEditor.escape_font_family((t!=null?t.family:void 0)||"inherit"),background_image_css:i,border_radius:this.state.theme.border_radius?this.state.theme.border_radius+"px":void 0,header_image_css:((c=this.state.theme.banner_image)!=null?c.size:void 0)==="full"?"width: 100%;":void 0},_.pick.apply(_,[this.state.theme].concat(ge.call(["bg_color","text_color","link_color"])))),v=new Proxy(v,{has:function(y){return function(){return!0}}(this)}),this.state.css_template(v)},apply_css:function(){var i,t;return this.style_el||(this.style_el=$("#user_theme").exists()||$("<style type='text/css' id='user_theme'></style>").appendTo($("head"))),this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||""),this._user_page||(this._user_page=$(".user_page.page_widget")),i=!!((t=this.state.theme.banner_image)!=null&&t.id),this._user_page.toggleClass("has_banner",i),this._user_page.toggleClass("mode_grid",this.state.theme.layout==="grid"),this._user_page.toggleClass("mode_column",this.state.theme.layout==="column"),this._user_page.toggleClass("mode_collection_grid",this.state.theme.collection_layout==="grid"),this._user_page.toggleClass("mode_show_purchases",!!this.state.theme.show_purchases),i&&(this._user_header_image||(this._user_header_image=$("#profile_header .profile_banner")),this.state.banner_image&&this._user_header_image.attr("src",this.state.banner_image.thumb_url)),this.props.can_use_css&&(this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head"))),this.custom_style_el[0].innerHTML=I.strip_css(this.state.theme.css||"")),this.load_font(this.state.theme.font_family)},apply_project_order:function(){var i,t,e,c,v,y,x,S,E,D,j,P;for(v=this._user_page.find(".user_game_grid"),t={},e=function(){var M,G,F,L;for(F=v.children(".game_cell"),L=[],M=0,G=F.length;M<G;M++)i=F[M],y=parseInt($(i).data("game_id")),t[y]=i,L.push(y);return L}(),x=this.state.theme.game_order||e,S=this.state.theme.hidden_games||[],P=[],E=0,j=x.length;E<j;E++)D=x[E],c=t[D],c&&(c.style.display=be.call(S,D)>=0?"none":"",P.push(v.append(c)));return P},apply_collection_order:function(){var i,t,e,c,v,y,x,S,E,D,j,P;for(e=this._user_page.find(".collections"),P={},c=function(){var M,G,F,L;for(F=e.children(".collection_row"),L=[],M=0,G=F.length;M<G;M++)j=F[M],i=parseInt($(j).data("collection_id")),P[i]=j,L.push(i);return L}(),t=this.state.theme.collection_order||c,y=this.state.theme.hidden_collections||[],D=[],x=0,E=t.length;x<E;x++)S=t[x],v=P[S],v&&(v.style.display=be.call(y,S)>=0?"none":"",D.push(e.append(v)));return D},load_font:function(i){var t;if(this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts)),!this.loaded_fonts[i]&&(this.loaded_fonts[i]=!0,t=this.state.fonts.find(function(e){return e.slug===i}),!!t&&t.href&&!$("link[data-font='"+t.slug+"']").exists()))return $("<link rel='stylesheet' href='"+t.href+"' data-font='"+t.slug+"'></link>").appendTo("head")},render:function(){return React.createElement(a,{key:"transition_group",component:"span"},this.state.open?React.createElement(o,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({key:"real",className:"theme_editor_widget"},f({},"You can edit your profile's content on your ",b({href:this.props.user_settings_url,target:"_blank"},"account profile settings"),"."),u({ref:this.form_ref||(this.form_ref=React.createRef()),method:"POST",onSubmit:function(i){return function(t){var e;return t.preventDefault(),e=JSON.stringify(i.state.theme),i.setState({loading:!0}),$.ajax({url:i.props.submit_url,type:"POST",data:I.with_csrf({theme:e}),xhrFields:{withCredentials:!0},error:function(c){return i.setState({loading:!1}),B(ne({errors:["Server error"],sub_text:"Your changes were not saved, please try again"}))},success:function(c){if(i.setState({loading:!1}),c.errors)return B(ne({errors:c.errors,sub_text:"Your changes were not saved, please try again"}))}})}}(this)},this.render_color_pickers(),this.render_text_settings(),this.render_images(),this.render_project_settings(),this.render_collection_order(),this.render_css_editor(),s({className:"buttons save_buttons"},r({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||!1},this.state.loading&&"Saving..."||"Save"))))},color_input:function(i,t){var e;return t==null&&(t={}),U({popout_portal_target:document.body,className:"compact",value:this.state.theme[i],allow_empty:t.allow_empty,onChange:this[e="set_"+i]||(this[e]=function(c){return function(v){return v===""&&(v=void 0),c.update_theme(i,v)}}(this))})},render_css_editor:function(){if(this.props.can_use_css)return h({className:"input_group css_editor"},m({},"Misc"),w.ThemeEditor.CssEditor({value:this.state.theme.css||"",css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(i){return function(t){return i.update_theme("css",t.target.value)}}(this))}))},render_color_pickers:function(){return h({className:"input_group"},m({},"Color"),p({className:"horiz_input"},g({className:"label_text"},"BG"),this.color_input("bg_color")),p({className:"horiz_input"},g({className:"label_text"},"Text"),this.color_input("text_color")),p({className:"horiz_input"},g({className:"label_text"},"Link"),this.color_input("link_color")))},render_text_settings:function(){var i;return h({className:"input_group"},m({},"Text"),p({className:"horiz_input"},g({className:"label_text"},"Font"),w.ThemeEditor.FontSelect({fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font||(this.append_font=function(t){return function(e){return t.setState({fonts:ge.call(t.state.fonts).concat([e])})}}(this)),value:this.state.theme.font_family||"",on_pick_family:this.set_font_family||(this.set_font_family=function(t){return function(e){return t.update_theme("font_family",e)}}(this))})),p({className:"horiz_input"},g({className:"label_text"},"Size"),Y({min:75,max:175,show_tooltip:!0,value:(i=this.state.theme.font_size)!=null?i:100,onChange:this.set_font_size||(this.set_font_size=function(t){return function(e){return t.update_theme("font_size",e)}}(this))})))},render_images:function(){var i;return h({className:"input_group"},m({},"Images"),W({compact:!0,upload_url:this.props.image_upload_url,upload:this.state.banner_image,label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(t){return function(e){return t.setState({banner_image:e}),t.update_theme("banner_image",Object.assign({},t.state.theme.banner_image||{size:"fixed"},{id:e!=null?e.id:void 0}))}}(this))},this.state.banner_image?s({className:"position_fields"},p({className:"horiz_input"},g({className:"label_text"},"Size"),w.Forms.SimpleSelect({value:((i=this.state.theme.banner_image)!=null?i.size:void 0)||"",onChange:this.set_banner_image_size||(this.set_banner_image_size=function(t){return function(e){return t.update_theme("banner_image",Object.assign({},t.state.theme.banner_image||{},{size:e}))}}(this)),options:this.banner_image_size_options||(this.banner_image_size_options=[{name:"Fixed width ",value:"fixed"},{name:"Full width",value:"full"}])}))):void 0),w.ThemeEditor.BackgroundImageUploader({image_upload_url:this.props.image_upload_url,upload:this.state.background_image,params:this.state.theme.background_image,on_change:function(t){return function(e,c){return t.update_theme("background_image",c),t.setState({background_image:e})}}(this)}))},render_project_settings:function(){var i;if(this.props.games&&this.props.games.length)return h({className:"input_group project_input_group"},m({},"My Projects"),p({className:"horiz_input"},g({className:"label_text"},"Layout"),w.Forms.SimpleSelect({value:this.state.theme.layout||"",onChange:this.set_layout||(this.set_layout=function(t){return function(e){return t.update_theme("layout",e)}}(this)),options:this.layout_options||(this.layout_options=[{name:"Sidebar",value:"column"},{name:"Grid",value:"grid"}])})),p({className:"horiz_input"},g({className:"label_text"},"B. Radius"),Y({min:0,max:150,show_tooltip:!0,value:(i=this.state.theme.border_radius)!=null?i:0,onChange:this.set_border_radius||(this.set_border_radius=function(t){return function(e){return t.update_theme("border_radius",e)}}(this))})),w.ThemeEditor.OrderPicker({items:this.props.games,update_order:this.set_game_order||(this.set_game_order=function(t){return function(e){var c;return t.setState({theme:Object.assign({},t.state.theme,{game_order:function(){var v,y,x;for(x=[],v=0,y=e.length;v<y;v++)c=e[v],x.push(c.id);return x}(),hidden_games:function(){var v,y,x;for(x=[],v=0,y=e.length;v<y;v++)c=e[v],c.hidden&&x.push(c.id);return x}()})})}}(this))}))},render_collection_order:function(){if(this.props.collections&&this.props.collections.length)return h({className:"input_group collection_input_group"},m({},"Collections"),p({className:"horiz_input"},g({className:"label_text"},"Layout"),w.Forms.SimpleSelect({value:this.state.theme.collection_layout||"",onChange:this.set_collection_layout||(this.set_collection_layout=function(i){return function(t){return i.update_theme("collection_layout",t)}}(this)),options:this.collection_layout_options||(this.collection_layout_options=[{name:"List",value:"list"},{name:"Grid",value:"grid"}])})),p({className:"horiz_input wide_label"},g({className:"label_text"},"Supported by me"),s({},d({type:"checkbox",checked:this.state.theme.show_purchases||!1,onChange:this.set_show_purchases||(this.set_show_purchases=function(i){return function(t){return i.update_theme("show_purchases",t.target.checked)}}(this))}))),w.ThemeEditor.OrderPicker({items:this.props.collections,update_order:this.set_collection_order||(this.set_collection_order=function(i){return function(t){var e;return i.setState({theme:Object.assign({},i.state.theme,{collection_order:function(){var c,v,y;for(y=[],c=0,v=t.length;c<v;c++)e=t[c],y.push(e.id);return y}(),hidden_collections:function(){var c,v,y;for(y=[],c=0,v=t.length;c<v;c++)e=t[c],e.hidden&&y.push(e.id);return y}()})})}}(this))}))}})});var Se=[].slice;I.libs.react.done(function(){var o,n,a,l,b,r,s,u,m,d,p,f;return n=T,a=n.button,u=n.label,b=n.fieldset,m=n.legend,l=n.div,d=n.select,r=n.fragment,f=n.textarea,s=n.input,p=n.span,r=React.createElement.bind(null,React.Fragment),r.type=React.fragment,o=w.package("ThemeEditor"),o.escape_font_family=function(h){return h.match(/ /)?"'"+h+"'":h},o.background_css=function(h,g){var i;return h?(i=function(){switch(g.position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}(),_.compact(["background-image: url('"+h.thumb_url+"')","background-repeat: "+(g.repeat||"repeat"),"background-position: "+i,g.attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):""},o("MoreGroup",{pure:!0,getInitialState:function(){return{open:!!this.props.default_open}},render_toggle:function(){return a({type:"button",className:"toggle_button",onClick:function(h){return function(){return h.setState({open:!h.state.open})}}(this)},this.props.label)},render:function(){return this.enclose({className:classNames("more_group",{open:this.state.open})},b({style:{display:this.state.open?"":"none"}},m({},this.render_toggle()),l({className:"more_children"},this.props.children)),this.state.open?void 0:this.render_toggle())}}),o("FontSelect",{pure:!0,propTypes:{fonts:k.array.isRequired,fonts_url:k.string.isRequired,allow_default:k.bool},open_google_fonts:function(){return B(w.ThemeEditor.FontPickerLightbox({fonts_url:this.props.fonts_url,on_pick_font:function(h){return function(g){var i,t,e,c,v,y;if(I.Lightbox.close(),y=g,t=h.props.fonts.find(function(x){return x.slug===y}),t){typeof(i=h.props).on_pick_family=="function"&&i.on_pick_family(g);return}return e={slug:y,name:g,family:g,type:"google_font",href:"https://fonts.googleapis.com/css?"+$.param({family:g+":400,400italic,700,700italic"})},(c=h.props)!=null&&c.on_add_font(e),(v=h.props)!=null?v.on_pick_family(e.family):void 0}}(this)}))},render:function(){var h;return w.Forms.SimpleSelect({name:this.props.name,value:this.props.value,onChange:function(g){return function(i){return i==="_select_google_font"?g.open_google_fonts():g.props.on_pick_family(i)}}(this),options:_.compact([this.props.allow_default?{name:"Default font",value:"_default"}:void 0,{name:"Select Google Font...",value:"_select_google_font"}].concat(Se.call(function(){var g,i,t,e;for(t=this.props.fonts,e=[],g=0,i=t.length;g<i;g++)h=t[g],e.push({name:h.name,value:h.slug,group:"Fonts"});return e}.call(this))))})}}),o("CssEditor",{pure:!0,render:function(){return r({},l({className:"label_help"},u({},l({className:"label_text"},"Custom CSS")),a({type:"button",className:"maximize_button textlike",title:"Expand",onClick:function(h){return function(g){return B(he({default_value:h.props.value,on_change:h.props.on_change,css_guide_url:h.props.css_guide_url}))}}(this)},"\u2197"),a({type:"button",className:"button small outline",onClick:function(h){return function(g){return B(te({css_guide_url:h.props.css_guide_url}))}}(this)},"Readme")),f({name:this.props.name,value:this.props.value,onChange:this.props.on_change}))}}),o("BackgroundImageUploader",{pure:!0,getDefaultProps:function(){return{default_params:{repeat:"repeat",position:"align_center"}}},propTypes:{input_name_prefix:k.string,image_upload_url:k.string.isRequired,upload:k.object,on_change:k.func,params:k.object},update_params:function(h){var g,i;return i=Object.assign({},this.props.params||{},h),typeof(g=this.props).on_change=="function"?g.on_change(this.props.upload,i):void 0},render:function(){var h,g,i;return W({compact:!0,upload_url:this.props.image_upload_url,upload:this.props.upload,name:this.props.input_name_prefix?this.props.input_name_prefix+"[image_id]":void 0,label:"Background",upload_label:"Upload",on_upload:this.props.on_change?this.on_upload||(this.on_upload=function(t){return function(e){var c,v;return v=Object.assign({},t.props.params||t.props.default_params,{id:e!=null?e.id:void 0}),typeof(c=t.props).on_change=="function"?c.on_change(e,v):void 0}}(this)):void 0},this.props.upload?l({className:"position_fields"},u({className:"horiz_input"},p({className:"label_text"},"Repeat"),w.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[repeat]":void 0,value:(h=this.props.params)!=null?h.repeat:void 0,onChange:this.props.on_change?this.set_repeat||(this.set_repeat=function(t){return function(e){return t.update_params({repeat:e})}}(this)):void 0,options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),u({className:"horiz_input"},p({className:"label_text"},"Align"),w.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[position]":void 0,value:(g=this.props.params)!=null?g.position:void 0,onChange:this.props.on_change?this.set_position||(this.set_position=function(t){return function(e){return t.update_params({position:e})}}(this)):void 0,options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])})),u({className:"horiz_input"},p({className:"label_text"},"Fixed"),l({},s({type:"checkbox",name:this.props.input_name_prefix?this.props.input_name_prefix+"[attach]":void 0,value:"fixed",checked:((i=this.props.params)!=null?i.attach:void 0)==="fixed",onChange:this.props.on_change?this.set_attach||(this.set_attach=function(t){return function(e){var c;return c=e.target.checked?"fixed":null,t.update_params({attach:c})}}(this)):void 0})))):void 0)}})})})();
